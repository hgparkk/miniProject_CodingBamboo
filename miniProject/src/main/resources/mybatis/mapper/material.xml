<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.codingbamboo.miniproject.material.dao.IMaterialDAO">

	<select id="selectAllMaterial" parameterType="String" resultType="MaterialDTO">
		SELECT
			me_no,
			me_name,
			me_emission
		FROM
			material_emissions
		WHERE
			me_name LIKE '%'||#{word}||'%'
	</select>
	
	<select id="selectMaterial" parameterType="int" resultType="MaterialDTO">
		SELECT
			me_no,
			me_name,
			me_emission
		FROM
			material_emissions
		WHERE
			me_no = ${meNo}
	</select>
	
	<sql id="materialSearch">
	  <if test="searchWord != null">
	  	<choose>
	  		<when test="searchOption == 'material'">AND me_name LIKE '%' || #{searchWord} || '%'</when>
	  		<when test="searchOption == 'kg'">AND me_emission LIKE '%' || #{searchWord} || '%'</when>
	  	</choose>
	  </if>
	</sql>
	
	<!-- <select id="getMaterialList" resultType="com.codingbamboo.miniproject.admin.dto.MaterialDTO">
		SELECT 
		    me_no
		    , me_name
		    , me_emission
		FROM material_emissions
	</select> -->
	
	<select id="getMaterialList" resultType="MaterialDTO" parameterType="com.codingbamboo.miniproject.common.SearchVO">
		SELECT *
		FROM (
			SELECT
				a.*
			FROM (
				SELECT 
				      me_no
				    , me_name
				    , me_emission
				FROM material_emissions
				WHERE 1=1
					<include refid="materialSearch"/>
			) a	
		)
	</select>
	
	<update id="updateMaterial" parameterType="MaterialDTO">
		UPDATE material_emissions
		SET me_name = #{meName}
		  , me_emission = #{meEmission}
		WHERE me_no = #{meNo}
	</update>
	
	<insert id="insertMaterial" parameterType="MaterialDTO">
		INSERT INTO material_emissions (
		      me_no
		    , me_name
		    , me_emission
		) VALUES (
		      (SELECT COUNT(*)+1 FROM material_emissions)
		    , #{meName}
		    , #{meEmission}
		)
	</insert>
	
	<select id="getMaterial" parameterType="String" resultType="MaterialDTO">
		SELECT
		      me_no
		    , me_name
		    , me_emission
		FROM material_emissions
	</select>
	
	<select id="getMaterialCount" resultType="int">
		SELECT COUNT(*)
		FROM material_emissions
		WHERE 1=1
		  <include refid="materialSearch"/>
	</select>
	
</mapper>